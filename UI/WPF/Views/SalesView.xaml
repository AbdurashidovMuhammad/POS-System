<UserControl x:Class="WPF.Views.SalesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:WPF.ViewModels"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:SalesViewModel}"
             d:DesignHeight="700" d:DesignWidth="1100">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="360"/>
        </Grid.ColumnDefinitions>

        <!-- ═══════════════ LEFT: Cart Panel ═══════════════ -->
        <Border Grid.Column="0" Background="{StaticResource BackgroundCardBrush}" CornerRadius="16" Margin="0,0,12,0">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="2" Opacity="0.06" Direction="270"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header with gradient accent -->
                <Border Grid.Row="0" CornerRadius="16,16,0,0">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0.5">
                            <GradientStop Color="{StaticResource PrimaryColor}" Offset="0"/>
                            <GradientStop Color="{StaticResource PrimaryDarkColor}" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Grid Margin="24,18">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Path Data="M17,18C15.89,18 15,18.89 15,20A2,2 0 0,0 17,22A2,2 0 0,0 19,20C19,18.89 18.1,18 17,18M1,2V4H3L6.6,11.59L5.24,14.04C5.09,14.32 5,14.65 5,15A2,2 0 0,0 7,17H19V15H7.42A0.25,0.25 0 0,1 7.17,14.75C7.17,14.7 7.18,14.66 7.2,14.63L8.1,13H15.55C16.3,13 16.96,12.58 17.3,11.97L20.88,5.5C20.95,5.34 21,5.17 21,5A1,1 0 0,0 20,4H5.21L4.27,2M7,18C5.89,18 5,18.89 5,20A2,2 0 0,0 7,22A2,2 0 0,0 9,20C9,18.89 8.1,18 7,18Z"
                                  Fill="White" Width="22" Height="22" Stretch="Uniform" Opacity="0.9"/>
                            <TextBlock Text="Savat" FontSize="18" FontWeight="SemiBold" Foreground="White" Margin="12,0,0,0" VerticalAlignment="Center"/>
                            <Border Background="Transparent" CornerRadius="12" Padding="10,4" Margin="12,0,0,0" VerticalAlignment="Center" BorderBrush="{StaticResource CountBadgeBorderBrush}" BorderThickness="1.5">
                                <TextBlock Text="{Binding CartItems.Count, StringFormat={}{0} ta}" FontSize="12" Foreground="White" FontWeight="Bold"/>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Barcode Input -->
                <Border Grid.Row="1" Padding="20,16,20,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Background="{StaticResource BackgroundInputBrush}" CornerRadius="10" BorderBrush="{StaticResource BorderDefaultBrush}" BorderThickness="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0" Background="{StaticResource PrimaryBrush}" CornerRadius="10,0,0,10" Padding="14,0">
                                    <Path Data="M2,6H4V18H2V6M5,6H6V18H5V6M7,6H10V18H7V6M11,6H12V18H11V6M14,6H16V18H14V6M17,6H20V18H17V6M21,6H22V18H21V6Z"
                                          Fill="White"
                                          Width="18" Height="18"
                                          Stretch="Uniform"
                                          VerticalAlignment="Center"/>
                                </Border>
                                <TextBox x:Name="BarcodeTextBox"
                                         Grid.Column="1"
                                         Text="{Binding BarcodeInput, UpdateSourceTrigger=PropertyChanged}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Padding="12,13"
                                         FontSize="14"
                                         VerticalContentAlignment="Center">
                                    <TextBox.InputBindings>
                                        <KeyBinding Key="Enter" Command="{Binding AddProductByBarcodeCommand}"/>
                                    </TextBox.InputBindings>
                                </TextBox>
                            </Grid>
                        </Border>

                        <!-- Search button -->
                        <Button Grid.Column="1"
                                Command="{Binding OpenSearchDialogCommand}"
                                ToolTip="Qidirish (F2)"
                                Margin="8,0,0,0"
                                Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border"
                                            Background="{StaticResource PrimaryLightBrush}"
                                            CornerRadius="10"
                                            Padding="14"
                                            BorderBrush="{StaticResource ActionButtonBorderBrush}"
                                            BorderThickness="1">
                                        <Path Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
                                              Fill="{StaticResource PrimaryBrush}"
                                              Width="18" Height="18"
                                              Stretch="Uniform"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <!-- Add button -->
                        <Button Grid.Column="2"
                                Command="{Binding AddProductByBarcodeCommand}"
                                Margin="8,0,0,0"
                                Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" CornerRadius="10" Padding="20,13">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Color="{StaticResource PrimaryColor}" Offset="0"/>
                                                <GradientStop Color="{StaticResource PrimaryDarkColor}" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                        <StackPanel Orientation="Horizontal">
                                            <Path Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"
                                                  Fill="White" Width="14" Height="14" Stretch="Uniform" Margin="0,0,6,0"/>
                                            <TextBlock Text="Qo'shish" Foreground="White" FontSize="13" FontWeight="SemiBold"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Opacity" Value="0.88"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </Border>

                <!-- Top Selling Products -->
                <ItemsControl Grid.Row="2" ItemsSource="{Binding TopSellingProducts}" Margin="20,0,20,8"
                              Visibility="{Binding TopSellingProducts.Count, Converter={StaticResource IntToVisibilityConverter}}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Command="{Binding DataContext.AddTopSellingProductCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                    CommandParameter="{Binding}"
                                    Margin="0,0,6,6"
                                    Cursor="Hand">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border"
                                                Background="{StaticResource PrimaryLighterBrush}"
                                                CornerRadius="8"
                                                Padding="12,7"
                                                BorderBrush="{StaticResource PrimaryLightBrush}"
                                                BorderThickness="1">
                                            <StackPanel Orientation="Horizontal">
                                                <Path Data="M17.56,21C17.43,21.63 16.85,22 16.22,22H7.78C7.15,22 6.57,21.63 6.44,21L4,12H20L17.56,21M12,2A3,3 0 0,1 15,5H9A3,3 0 0,1 12,2M20,7H4A1,1 0 0,0 3,8V10C3,10.55 3.45,11 4,11H20C20.55,11 21,10.55 21,10V8A1,1 0 0,0 20,7Z"
                                                      Fill="{StaticResource PrimaryBrush}" Width="13" Height="13" Stretch="Uniform" Margin="0,0,6,0" Opacity="0.7"/>
                                                <TextBlock Text="{Binding Name}"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"
                                                           Foreground="{StaticResource PrimaryDarkBrush}"
                                                           VerticalAlignment="Center"/>
                                                <TextBlock Text="{Binding UnitPrice, StringFormat=' · {0:N0}'}"
                                                           FontSize="11"
                                                           Foreground="{StaticResource PrimaryBrush}"
                                                           VerticalAlignment="Center"
                                                           Opacity="0.7"/>
                                            </StackPanel>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Column headers -->
                <Border Grid.Row="3" Padding="20,0,20,0"
                        Visibility="{Binding CartItems.Count, Converter={StaticResource IntToVisibilityConverter}}">
                    <Border Background="{StaticResource BackgroundInputBrush}" CornerRadius="8" Padding="12,10" Margin="0,4,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="36"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="130"/>
                                <ColumnDefinition Width="110"/>
                                <ColumnDefinition Width="40"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="#" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" FontWeight="Bold"/>
                            <TextBlock Grid.Column="1" Text="Mahsulot" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" FontWeight="Bold"/>
                            <TextBlock Grid.Column="2" Text="Miqdor" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" FontWeight="Bold" HorizontalAlignment="Center"/>
                            <TextBlock Grid.Column="3" Text="Summa" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" FontWeight="Bold" HorizontalAlignment="Right"/>
                        </Grid>
                    </Border>
                </Border>

                <!-- Cart Items List -->
                <ListView Grid.Row="4"
                          ItemsSource="{Binding CartItems}"
                          BorderThickness="0"
                          Background="Transparent"
                          Margin="8,0,8,8"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0,2"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListViewItem">
                                        <Border x:Name="border" Background="Transparent" CornerRadius="10">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="{StaticResource BackgroundInputBrush}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="12,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="36"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="130"/>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Row number -->
                                    <Border Grid.Column="0" Background="{StaticResource PrimaryLightBrush}" CornerRadius="8" Width="28" Height="28" VerticalAlignment="Center" HorizontalAlignment="Left">
                                        <TextBlock Text="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Converter={StaticResource IndexConverter}}"
                                                   FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource PrimaryBrush}"
                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>

                                    <!-- Product info -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="4,0,0,0">
                                        <TextBlock Text="{Binding Product.Name}"
                                                   FontSize="13.5"
                                                   FontWeight="SemiBold"
                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                            <TextBlock Text="{Binding Product.UnitPrice, StringFormat={}{0:N0} sum}"
                                                       FontSize="12"
                                                       Foreground="{StaticResource TextMutedBrush}"/>
                                            <TextBlock Text="  ·  " FontSize="12" Foreground="{StaticResource TextSeparatorBrush}"/>
                                            <TextBlock Text="{Binding Product.StockQuantity, StringFormat=Ombor: {0:N0}}"
                                                       FontSize="11"
                                                       Foreground="{StaticResource WarningBrush}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Quantity stepper -->
                                    <Border Grid.Column="2" Background="{StaticResource BackgroundInputBrush}" CornerRadius="10" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Minus button -->
                                            <Button Grid.Column="0"
                                                    Command="{Binding DataContext.DecrementQuantityCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}"
                                                    Cursor="Hand">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border x:Name="border" Background="Transparent" CornerRadius="10,0,0,10" Padding="10,8">
                                                            <Path Data="M19,13H5V11H19V13Z" Fill="{StaticResource TextTertiaryBrush}" Width="12" Height="12" Stretch="Uniform"/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="border" Property="Background" Value="{StaticResource BorderDefaultBrush}"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>

                                            <!-- Quantity display -->
                                            <TextBox Grid.Column="1"
                                                     Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}"
                                                     Background="{StaticResource BackgroundCardBrush}"
                                                     BorderThickness="0"
                                                     TextAlignment="Center"
                                                     FontSize="14"
                                                     FontWeight="SemiBold"
                                                     MinWidth="48"
                                                     Padding="4,6"
                                                     VerticalContentAlignment="Center"/>

                                            <!-- Plus button -->
                                            <Button Grid.Column="2"
                                                    Command="{Binding DataContext.IncrementQuantityCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}"
                                                    Cursor="Hand">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border x:Name="border" Background="Transparent" CornerRadius="0,10,10,0" Padding="10,8">
                                                            <Path Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" Fill="{StaticResource PrimaryBrush}" Width="12" Height="12" Stretch="Uniform"/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </Grid>
                                    </Border>

                                    <!-- Subtotal -->
                                    <TextBlock Grid.Column="3"
                                               Text="{Binding Subtotal, StringFormat={}{0:N0}}"
                                               FontSize="14"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource PrimaryDarkBrush}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right"/>

                                    <!-- Remove button -->
                                    <Button Grid.Column="4"
                                            Command="{Binding DataContext.RemoveItemCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}"
                                            Cursor="Hand"
                                            VerticalAlignment="Center">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="border"
                                                        Background="Transparent"
                                                        CornerRadius="8"
                                                        Padding="8,6">
                                                    <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                                                          Fill="{StaticResource TextSeparatorBrush}"
                                                          Width="12" Height="12"
                                                          Stretch="Uniform"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="border" Property="Background" Value="{StaticResource ErrorBackgroundBrush}"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Empty Cart -->
                <StackPanel Grid.Row="4"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="{Binding CartItems.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=invert}">
                    <Border Background="{StaticResource PrimaryLightBrush}" CornerRadius="24" Width="80" Height="80" HorizontalAlignment="Center" Padding="0">
                        <Path Data="M17,18C15.89,18 15,18.89 15,20A2,2 0 0,0 17,22A2,2 0 0,0 19,20C19,18.89 18.1,18 17,18M1,2V4H3L6.6,11.59L5.24,14.04C5.09,14.32 5,14.65 5,15A2,2 0 0,0 7,17H19V15H7.42A0.25,0.25 0 0,1 7.17,14.75C7.17,14.7 7.18,14.66 7.2,14.63L8.1,13H15.55C16.3,13 16.96,12.58 17.3,11.97L20.88,5.5C20.95,5.34 21,5.17 21,5A1,1 0 0,0 20,4H5.21L4.27,2M7,18C5.89,18 5,18.89 5,20A2,2 0 0,0 7,22A2,2 0 0,0 9,20C9,18.89 8.1,18 7,18Z"
                              Fill="{StaticResource PrimaryBrush}"
                              Width="36" Height="36"
                              Stretch="Uniform"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              Opacity="0.5"/>
                    </Border>
                    <TextBlock Text="Savat hali bo'sh"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,0"/>
                    <TextBlock Text="Shtrix kodni skanerlang yoki qidiruvdan foydalaning"
                               FontSize="13"
                               Foreground="{StaticResource TextFaintBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,6,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ═══════════════ RIGHT: Summary Panel ═══════════════ -->
        <Border Grid.Column="1" Background="{StaticResource BackgroundCardBrush}" CornerRadius="16">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="2" Opacity="0.06" Direction="270"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Total amount hero section -->
                <Border Grid.Row="0" CornerRadius="16,16,0,0" Padding="24,28">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="{StaticResource PrimaryLightColor}" Offset="0"/>
                            <GradientStop Color="{StaticResource PrimaryLighterColor}" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <StackPanel>
                        <TextBlock Text="Jami summa" FontSize="13" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,8,0,0">
                            <TextBlock Text="{Binding TotalAmount, StringFormat={}{0:N0}}"
                                       FontSize="40"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource PrimaryDarkBrush}"/>
                            <TextBlock Text=" sum"
                                       FontSize="18"
                                       Foreground="{StaticResource PrimaryBrush}"
                                       VerticalAlignment="Bottom"
                                       Margin="4,0,0,8"/>
                        </StackPanel>

                        <!-- Quick stats row -->
                        <Grid Margin="0,16,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Background="{StaticResource BackgroundCardBrush}" CornerRadius="10" Padding="14,10">
                                <StackPanel HorizontalAlignment="Center">
                                    <TextBlock Text="Turlar" FontSize="11" Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Center" Opacity="0.7"/>
                                    <TextBlock Text="{Binding CartItems.Count, StringFormat={}{0} ta}" FontSize="16" FontWeight="Bold" Foreground="{StaticResource PrimaryDarkBrush}" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="2" Background="{StaticResource BackgroundCardBrush}" CornerRadius="10" Padding="14,10">
                                <StackPanel HorizontalAlignment="Center">
                                    <TextBlock Text="Miqdor" FontSize="11" Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Center" Opacity="0.7"/>
                                    <TextBlock Text="{Binding TotalQuantity, StringFormat={}{0:N0}}" FontSize="16" FontWeight="Bold" Foreground="{StaticResource PrimaryDarkBrush}" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Payment type selection -->
                <StackPanel Grid.Row="1" Margin="20,20,20,0">
                    <TextBlock Text="To'lov usuli" FontSize="13" FontWeight="SemiBold" Foreground="{StaticResource TextSecondaryBrush}" Margin="4,0,0,10"/>

                    <UniformGrid Columns="3" Margin="0,0,0,4">
                        <!-- Naqd -->
                        <Button Command="{Binding SelectPaymentTypeCommand}" CommandParameter="1" Margin="3" Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{StaticResource BackgroundInputBrush}" CornerRadius="10" Padding="10,12" BorderBrush="{StaticResource BorderDefaultBrush}" BorderThickness="1.5">
                                        <StackPanel HorizontalAlignment="Center">
                                            <!-- Cash/money icon -->
                                            <Path x:Name="icon" Data="M3,6H21V18H3V6M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M7,8A2,2 0 0,1 5,10V14A2,2 0 0,1 7,16H17A2,2 0 0,1 19,14V10A2,2 0 0,1 17,8H7Z"
                                                  Fill="{StaticResource TextMutedBrush}" Width="20" Height="20" Stretch="Uniform"/>
                                            <TextBlock x:Name="txt" Text="Naqd" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <DataTrigger Binding="{Binding SelectedPaymentType}" Value="1">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="icon" Property="Fill" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="txt" Property="Foreground" Value="{StaticResource PrimaryDarkBrush}"/>
                                        </DataTrigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource BorderLightBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <!-- Karta -->
                        <Button Command="{Binding SelectPaymentTypeCommand}" CommandParameter="2" Margin="3" Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{StaticResource BackgroundInputBrush}" CornerRadius="10" Padding="10,12" BorderBrush="{StaticResource BorderDefaultBrush}" BorderThickness="1.5">
                                        <StackPanel HorizontalAlignment="Center">
                                            <!-- Credit card icon -->
                                            <Path x:Name="icon" Data="M20,8H4V6H20M20,18H4V12H20M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"
                                                  Fill="{StaticResource TextMutedBrush}" Width="20" Height="20" Stretch="Uniform"/>
                                            <TextBlock x:Name="txt" Text="Karta" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <DataTrigger Binding="{Binding SelectedPaymentType}" Value="2">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="icon" Property="Fill" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="txt" Property="Foreground" Value="{StaticResource PrimaryDarkBrush}"/>
                                        </DataTrigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource BorderLightBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <!-- Payme -->
                        <Button Command="{Binding SelectPaymentTypeCommand}" CommandParameter="3" Margin="3" Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{StaticResource BackgroundInputBrush}" CornerRadius="10" Padding="10,12" BorderBrush="{StaticResource BorderDefaultBrush}" BorderThickness="1.5">
                                        <StackPanel HorizontalAlignment="Center">
                                            <!-- Smartphone/mobile payment icon -->
                                            <Path x:Name="icon" Data="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V3C19,1.89 18.1,1 17,1Z"
                                                  Fill="{StaticResource TextMutedBrush}" Width="20" Height="20" Stretch="Uniform"/>
                                            <TextBlock x:Name="txt" Text="Payme" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <DataTrigger Binding="{Binding SelectedPaymentType}" Value="3">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="icon" Property="Fill" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="txt" Property="Foreground" Value="{StaticResource PrimaryDarkBrush}"/>
                                        </DataTrigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource BorderLightBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </UniformGrid>

                    <UniformGrid Columns="3" Margin="0,0,0,4">
                        <!-- Click -->
                        <Button Command="{Binding SelectPaymentTypeCommand}" CommandParameter="4" Margin="3" Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{StaticResource BackgroundInputBrush}" CornerRadius="10" Padding="10,12" BorderBrush="{StaticResource BorderDefaultBrush}" BorderThickness="1.5">
                                        <StackPanel HorizontalAlignment="Center">
                                            <!-- Smartphone/mobile payment icon -->
                                            <Path x:Name="icon" Data="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V3C19,1.89 18.1,1 17,1Z"
                                                  Fill="{StaticResource TextMutedBrush}" Width="20" Height="20" Stretch="Uniform"/>
                                            <TextBlock x:Name="txt" Text="Click" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <DataTrigger Binding="{Binding SelectedPaymentType}" Value="4">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="icon" Property="Fill" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="txt" Property="Foreground" Value="{StaticResource PrimaryDarkBrush}"/>
                                        </DataTrigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource BorderLightBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <!-- Paynet -->
                        <Button Command="{Binding SelectPaymentTypeCommand}" CommandParameter="5" Margin="3" Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{StaticResource BackgroundInputBrush}" CornerRadius="10" Padding="10,12" BorderBrush="{StaticResource BorderDefaultBrush}" BorderThickness="1.5">
                                        <StackPanel HorizontalAlignment="Center">
                                            <!-- Smartphone/mobile payment icon -->
                                            <Path x:Name="icon" Data="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V3C19,1.89 18.1,1 17,1Z"
                                                  Fill="{StaticResource TextMutedBrush}" Width="20" Height="20" Stretch="Uniform"/>
                                            <TextBlock x:Name="txt" Text="Paynet" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <DataTrigger Binding="{Binding SelectedPaymentType}" Value="5">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="icon" Property="Fill" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="txt" Property="Foreground" Value="{StaticResource PrimaryDarkBrush}"/>
                                        </DataTrigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource BorderLightBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <!-- Uzum Bank -->
                        <Button Command="{Binding SelectPaymentTypeCommand}" CommandParameter="6" Margin="3" Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="{StaticResource BackgroundInputBrush}" CornerRadius="10" Padding="10,12" BorderBrush="{StaticResource BorderDefaultBrush}" BorderThickness="1.5">
                                        <StackPanel HorizontalAlignment="Center">
                                            <!-- Smartphone/mobile payment icon -->
                                            <Path x:Name="icon" Data="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V3C19,1.89 18.1,1 17,1Z"
                                                  Fill="{StaticResource TextMutedBrush}" Width="20" Height="20" Stretch="Uniform"/>
                                            <TextBlock x:Name="txt" Text="Uzum" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <DataTrigger Binding="{Binding SelectedPaymentType}" Value="6">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="icon" Property="Fill" Value="{StaticResource PrimaryBrush}"/>
                                            <Setter TargetName="txt" Property="Foreground" Value="{StaticResource PrimaryDarkBrush}"/>
                                        </DataTrigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource BorderLightBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </UniformGrid>

                    <!-- Boshqa app - full width -->
                    <Button Command="{Binding SelectPaymentTypeCommand}" CommandParameter="7" Margin="3,0,3,0" Cursor="Hand">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" Background="{StaticResource BackgroundInputBrush}" CornerRadius="10" Padding="10,10" BorderBrush="{StaticResource BorderDefaultBrush}" BorderThickness="1.5">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <!-- Other app icon -->
                                        <Path x:Name="icon" Data="M6,2H18A2,2 0 0,1 20,4V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M12,4A6,6 0 0,0 6,10C6,13.31 8.69,16 12,16A6,6 0 0,0 18,10A6,6 0 0,0 12,4M12,6A4,4 0 0,1 16,10A4,4 0 0,1 12,14A4,4 0 0,1 8,10A4,4 0 0,1 12,6M12,19A1,1 0 0,0 11,20A1,1 0 0,0 12,21A1,1 0 0,0 13,20A1,1 0 0,0 12,19Z"
                                              Fill="{StaticResource TextMutedBrush}" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                                        <TextBlock x:Name="txt" Text="Boshqa ilova" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource TextTertiaryBrush}" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <DataTrigger Binding="{Binding SelectedPaymentType}" Value="7">
                                        <Setter TargetName="border" Property="Background" Value="{StaticResource SuccessBackgroundBrush}"/>
                                        <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource SuccessBrush}"/>
                                        <Setter TargetName="icon" Property="Fill" Value="{StaticResource SuccessBrush}"/>
                                        <Setter TargetName="txt" Property="Foreground" Value="{StaticResource SuccessDarkBrush}"/>
                                    </DataTrigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="{StaticResource BorderLightBrush}"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Row="2" Margin="20,0,20,20">
                    <!-- Error Message -->
                    <Border Background="{StaticResource ErrorBackgroundBrush}"
                            Padding="14"
                            CornerRadius="10"
                            Margin="0,0,0,12"
                            Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"
                                  Fill="{StaticResource ErrorBrush}" Width="16" Height="16" Stretch="Uniform" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding ErrorMessage}"
                                       Foreground="{StaticResource ErrorTextBrush}"
                                       TextWrapping="Wrap"
                                       FontSize="12.5"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Success Message -->
                    <Border Background="{StaticResource SuccessBackgroundBrush}"
                            Padding="14"
                            CornerRadius="10"
                            Margin="0,0,0,12"
                            Visibility="{Binding SuccessMessage, Converter={StaticResource NullToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z"
                                  Fill="{StaticResource SuccessBrush}" Width="16" Height="16" Stretch="Uniform" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding SuccessMessage}"
                                       Foreground="{StaticResource SuccessDarkBrush}"
                                       TextWrapping="Wrap"
                                       FontSize="12.5"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Clear button -->
                    <Button Command="{Binding ClearCartCommand}" Margin="0,0,0,10" Cursor="Hand">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border"
                                        Background="{StaticResource BackgroundInputBrush}"
                                        CornerRadius="12"
                                        Padding="0,14"
                                        BorderBrush="{StaticResource BorderDefaultBrush}"
                                        BorderThickness="1.5">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Path Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"
                                              Fill="{StaticResource TextMutedBrush}" Width="15" Height="15" Stretch="Uniform" Margin="0,0,8,0"/>
                                        <TextBlock Text="Tozalash" Foreground="{StaticResource TextSecondaryBrush}" FontSize="14" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="{StaticResource BorderLightBrush}"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>

                    <!-- Complete sale button -->
                    <Button Command="{Binding CompleteSaleCommand}" Cursor="Hand">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" CornerRadius="12" Padding="0,16">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0.5">
                                            <GradientStop Color="{StaticResource PrimaryColor}" Offset="0"/>
                                            <GradientStop Color="{StaticResource PrimaryDarkColor}" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.2" Color="{StaticResource PrimaryColor}" Direction="270"/>
                                    </Border.Effect>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Path Data="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"
                                              Fill="White" Width="18" Height="18" Stretch="Uniform" Margin="0,0,10,0"/>
                                        <TextBlock Text="Sotishni yakunlash" Foreground="White" FontSize="16" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Opacity" Value="0.9"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ═══════════════ Search Dialog Overlay ═══════════════ -->
        <Border Grid.ColumnSpan="2"
                Background="{StaticResource OverlayModalBrush}"
                Visibility="{Binding IsSearchDialogOpen, Converter={StaticResource BoolToVisibilityConverter}}"
                MouseLeftButtonDown="SearchOverlay_MouseLeftButtonDown">

            <Border Background="{StaticResource BackgroundCardBrush}"
                    CornerRadius="20"
                    Width="560"
                    MinHeight="420"
                    MaxHeight="620"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Padding="0"
                    MouseLeftButtonDown="SearchDialog_MouseLeftButtonDown">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="40" ShadowDepth="5" Opacity="0.2" Direction="270"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Border Grid.Row="0" Padding="28,22,28,16">
                        <Grid>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Border Background="{StaticResource PrimaryLightBrush}" CornerRadius="10" Padding="8">
                                    <Path Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
                                          Fill="{StaticResource PrimaryBrush}" Width="18" Height="18" Stretch="Uniform"/>
                                </Border>
                                <TextBlock Text="Mahsulot qidirish"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           Margin="12,0,0,0"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                            <Button HorizontalAlignment="Right"
                                    Command="{Binding CloseSearchDialogCommand}"
                                    Cursor="Hand">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" Background="{StaticResource BackgroundInputBrush}" CornerRadius="8" Padding="8">
                                            <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                                                  Fill="{StaticResource TextMutedBrush}" Width="14" Height="14" Stretch="Uniform"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="{StaticResource BorderDefaultBrush}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Search Input -->
                    <Border Grid.Row="1" Margin="28,0,28,12" Background="{StaticResource BackgroundInputBrush}" CornerRadius="12" BorderBrush="{StaticResource BorderDefaultBrush}" BorderThickness="1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Path Grid.Column="0"
                                  Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
                                  Fill="{StaticResource TextFaintBrush}"
                                  Width="18" Height="18"
                                  Stretch="Uniform"
                                  Margin="16,0,8,0"
                                  VerticalAlignment="Center"/>
                            <TextBox x:Name="SearchDialogTextBox"
                                     Grid.Column="1"
                                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Padding="4,14"
                                     FontSize="14"
                                     VerticalContentAlignment="Center">
                                <TextBox.InputBindings>
                                    <KeyBinding Key="Enter" Command="{Binding SearchProductsCommand}"/>
                                </TextBox.InputBindings>
                            </TextBox>
                            <Button Grid.Column="2"
                                    Command="{Binding SearchProductsCommand}"
                                    Margin="4"
                                    Cursor="Hand">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" CornerRadius="8" Padding="18,10">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Color="{StaticResource PrimaryColor}" Offset="0"/>
                                                    <GradientStop Color="{StaticResource PrimaryDarkColor}" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <TextBlock Text="Qidirish" Foreground="White" FontSize="13" FontWeight="SemiBold"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Opacity" Value="0.85"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Search Results -->
                    <ListView Grid.Row="2"
                              ItemsSource="{Binding SearchResults}"
                              SelectedItem="{Binding SelectedSearchProduct}"
                              BorderThickness="0"
                              Background="Transparent"
                              Margin="28,0"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0,2"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListViewItem">
                                            <Border x:Name="border" Background="Transparent" CornerRadius="10" Margin="0">
                                                <ContentPresenter/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="{StaticResource BackgroundInputBrush}"/>
                                                </Trigger>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLighterBrush}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="14,10" Cursor="Hand">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                                <Border Background="{StaticResource PrimaryLighterBrush}" CornerRadius="4" Padding="6,2" Margin="0,0,8,0">
                                                    <TextBlock Text="{Binding UnitType, Converter={StaticResource EnumToStringConverter}}"
                                                               FontSize="10" Foreground="{StaticResource PrimaryBrush}" FontWeight="SemiBold"/>
                                                </Border>
                                                <TextBlock Text="{Binding Barcode}" FontSize="11" Foreground="{StaticResource TextFaintBrush}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <Border Grid.Column="1" Background="{StaticResource WarningBackgroundBrush}" CornerRadius="6" Padding="8,4" VerticalAlignment="Center" Margin="10,0">
                                            <TextBlock Text="{Binding StockQuantity, StringFormat=Ombor: {0:0.##}}"
                                                       FontSize="11" Foreground="{StaticResource WarningBrush}" FontWeight="SemiBold"/>
                                        </Border>
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding UnitPrice, StringFormat={}{0:N0} sum}"
                                                   FontSize="14" FontWeight="Bold" Foreground="{StaticResource PrimaryDarkBrush}"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- Selected Product - Quantity Input -->
                    <Border Grid.Row="3"
                            Margin="28,8"
                            Background="{StaticResource BackgroundInputBrush}"
                            CornerRadius="12"
                            Padding="18"
                            Visibility="{Binding SelectedSearchProduct, Converter={StaticResource NullToVisibilityConverter}}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <TextBlock FontSize="13" Foreground="{StaticResource TextTertiaryBrush}">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="Miqdor ({0}):">
                                            <Binding Path="SelectedSearchProduct.UnitType" Converter="{StaticResource EnumToStringConverter}"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>

                                <!-- Normal input (boshqa o'lchov birliklari uchun) -->
                                <Border Background="{StaticResource BackgroundCardBrush}" CornerRadius="8" Margin="0,6,0,0" BorderBrush="{StaticResource BorderPopupBrush}" BorderThickness="1"
                                        Visibility="{Binding IsManualGramm, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=invert}">
                                    <TextBox x:Name="ManualQuantityTextBox"
                                             Text="{Binding ManualQuantityText, UpdateSourceTrigger=PropertyChanged}"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Padding="14,10"
                                             FontSize="16"
                                             FontWeight="SemiBold"
                                             VerticalContentAlignment="Center">
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Enter" Command="{Binding AddManualProductCommand}"/>
                                        </TextBox.InputBindings>
                                    </TextBox>
                                </Border>

                                <!-- Gramm uchun kg + gramm split input -->
                                <Grid Margin="0,6,0,0"
                                      Visibility="{Binding IsManualGramm, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Background="{StaticResource BackgroundCardBrush}" CornerRadius="8" BorderBrush="{StaticResource BorderPopupBrush}" BorderThickness="1">
                                        <TextBox x:Name="ManualKgTextBox"
                                                 Text="{Binding ManualKg, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Padding="14,10"
                                                 FontSize="16"
                                                 FontWeight="SemiBold"
                                                 HorizontalContentAlignment="Center"
                                                 VerticalContentAlignment="Center">
                                            <TextBox.InputBindings>
                                                <KeyBinding Key="Enter" Command="{Binding AddManualProductCommand}"/>
                                            </TextBox.InputBindings>
                                        </TextBox>
                                    </Border>
                                    <TextBlock Grid.Column="1" Text="kg" FontSize="14" FontWeight="Bold" Foreground="{StaticResource PrimaryBrush}"
                                               VerticalAlignment="Center" Margin="8,0,14,0"/>

                                    <Border Grid.Column="2" Background="{StaticResource BackgroundCardBrush}" CornerRadius="8" BorderBrush="{StaticResource BorderPopupBrush}" BorderThickness="1">
                                        <TextBox x:Name="ManualGrammTextBox"
                                                 Text="{Binding ManualGramm, StringFormat=000}"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Padding="14,10"
                                                 FontSize="16"
                                                 FontWeight="SemiBold"
                                                 HorizontalContentAlignment="Center"
                                                 VerticalContentAlignment="Center"
                                                 MaxLength="3"
                                                 GotFocus="GrammTextBox_GotFocus"
                                                 PreviewTextInput="GrammTextBox_PreviewTextInput"
                                                 LostFocus="GrammTextBox_LostFocus">
                                            <TextBox.InputBindings>
                                                <KeyBinding Key="Enter" Command="{Binding AddManualProductCommand}"/>
                                            </TextBox.InputBindings>
                                        </TextBox>
                                    </Border>
                                    <TextBlock Grid.Column="3" Text="gr" FontSize="14" FontWeight="Bold" Foreground="{StaticResource TextTertiaryBrush}"
                                               VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </Grid>
                            </StackPanel>
                            <Button Grid.Column="1"
                                    Command="{Binding AddManualProductCommand}"
                                    Margin="14,0,0,0"
                                    Cursor="Hand"
                                    VerticalAlignment="Bottom">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" CornerRadius="10" Padding="24,14">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Color="{StaticResource PrimaryColor}" Offset="0"/>
                                                    <GradientStop Color="{StaticResource PrimaryDarkColor}" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <StackPanel Orientation="Horizontal">
                                                <Path Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"
                                                      Fill="White" Width="14" Height="14" Stretch="Uniform" Margin="0,0,6,0"/>
                                                <TextBlock Text="Qo'shish" Foreground="White" FontSize="14" FontWeight="SemiBold"/>
                                            </StackPanel>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Opacity" Value="0.88"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Search Error -->
                    <Border Grid.Row="4"
                            Margin="28,0,28,20"
                            Padding="12"
                            CornerRadius="10"
                            Background="{StaticResource ErrorBackgroundBrush}"
                            Visibility="{Binding SearchError, Converter={StaticResource NullToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"
                                  Fill="{StaticResource ErrorBrush}" Width="14" Height="14" Stretch="Uniform" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding SearchError}" Foreground="{StaticResource ErrorTextBrush}" FontSize="13" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Border>

        <!-- ═══════════════ Receipt Dialog Overlay ═══════════════ -->
        <Border Grid.ColumnSpan="2"
                Background="{StaticResource OverlayModalBrush}"
                Visibility="{Binding IsReceiptDialogOpen, Converter={StaticResource BoolToVisibilityConverter}}"
                MouseLeftButtonDown="ReceiptOverlay_MouseLeftButtonDown">

            <Border Background="{StaticResource BackgroundCardBrush}"
                    CornerRadius="20"
                    Width="440"
                    MaxHeight="700"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Padding="0"
                    MouseLeftButtonDown="ReceiptDialog_MouseLeftButtonDown">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="40" ShadowDepth="5" Opacity="0.2" Direction="270"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Border Grid.Row="0" CornerRadius="20,20,0,0" Padding="28,22">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0.5">
                                <GradientStop Color="{StaticResource PrimaryColor}" Offset="0"/>
                                <GradientStop Color="{StaticResource PrimaryDarkColor}" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <Grid>
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="SOTUV CHEKI"
                                           FontSize="12"
                                           FontWeight="Bold"
                                           Foreground="White"
                                           HorizontalAlignment="Center"
                                           Opacity="0.75"
                                           Margin="0,0,0,4"/>
                                <TextBlock Text="{Binding LastSaleResult.Id, StringFormat='#{0}'}"
                                           FontSize="30"
                                           FontWeight="Bold"
                                           Foreground="White"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                            <Button HorizontalAlignment="Right" VerticalAlignment="Top"
                                    Command="{Binding CloseReceiptDialogCommand}"
                                    Cursor="Hand">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" Background="#33FFFFFF" CornerRadius="8" Padding="8">
                                            <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                                                  Fill="White" Width="14" Height="14" Stretch="Uniform"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#55FFFFFF"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Receipt Content -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="ReceiptPrintArea" Margin="28,20,28,8">

                            <!-- Info: Sana & Kassir -->
                            <Grid Margin="0,0,0,14">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Sana" FontSize="11" Foreground="{StaticResource TextFaintBrush}"
                                               FontWeight="Bold" Margin="0,0,0,4"/>
                                    <TextBlock Text="{Binding LastSaleResult.SaleDate, StringFormat='dd.MM.yyyy HH:mm'}"
                                               FontSize="13" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Kassir" FontSize="11" Foreground="{StaticResource TextFaintBrush}"
                                               FontWeight="Bold" Margin="0,0,0,4"/>
                                    <TextBlock Text="{Binding LastSaleResult.UserFullName}"
                                               FontSize="13" Foreground="{StaticResource TextPrimaryBrush}"
                                               FontWeight="SemiBold" TextWrapping="Wrap"/>
                                </StackPanel>
                            </Grid>

                            <!-- Payment Type Badge -->
                            <Border Background="{StaticResource PrimaryLightBrush}" CornerRadius="8"
                                    Padding="12,7" Margin="0,0,0,14" HorizontalAlignment="Left">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M20,8H4V6H20M20,18H4V12H20M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"
                                          Fill="{StaticResource PrimaryBrush}" Width="14" Height="14" Stretch="Uniform"
                                          Margin="0,0,7,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding LastSaleResult.PaymentTypeName}"
                                               FontSize="12" Foreground="{StaticResource PrimaryDarkBrush}"
                                               FontWeight="SemiBold" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>

                            <!-- Divider -->
                            <Border Height="1" Background="{StaticResource BorderDefaultBrush}" Margin="0,0,0,10"/>

                            <!-- Items Header -->
                            <Grid Margin="0,0,0,6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="56"/>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="90"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Mahsulot"
                                           FontSize="11" Foreground="{StaticResource TextFaintBrush}" FontWeight="Bold"/>
                                <TextBlock Grid.Column="1" Text="Miqdor"
                                           FontSize="11" Foreground="{StaticResource TextFaintBrush}" FontWeight="Bold"
                                           HorizontalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="Narx"
                                           FontSize="11" Foreground="{StaticResource TextFaintBrush}" FontWeight="Bold"
                                           HorizontalAlignment="Right"/>
                                <TextBlock Grid.Column="3" Text="Jami"
                                           FontSize="11" Foreground="{StaticResource TextFaintBrush}" FontWeight="Bold"
                                           HorizontalAlignment="Right"/>
                            </Grid>

                            <!-- Items -->
                            <ItemsControl ItemsSource="{Binding LastSaleResult.Items}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="0,9"
                                                BorderBrush="{StaticResource BorderLightBrush}"
                                                BorderThickness="0,0,0,1">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="56"/>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="90"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="{Binding ProductName}"
                                                           FontSize="13" Foreground="{StaticResource TextPrimaryBrush}"
                                                           TextWrapping="Wrap" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding Quantity, StringFormat={}{0:0.##}}"
                                                           FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding UnitPrice, StringFormat={}{0:N0}}"
                                                           FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"
                                                           HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="3"
                                                           Text="{Binding Subtotal, StringFormat={}{0:N0}}"
                                                           FontSize="13" FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextPrimaryBrush}"
                                                           HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Total -->
                            <Border Margin="0,14,0,4" Background="{StaticResource PrimaryLighterBrush}"
                                    CornerRadius="10" Padding="16,13">
                                <Grid>
                                    <TextBlock Text="JAMI SUMMA"
                                               FontSize="13" FontWeight="Bold"
                                               Foreground="{StaticResource PrimaryDarkBrush}"
                                               VerticalAlignment="Center"/>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding LastSaleResult.TotalAmount, StringFormat={}{0:N0}}"
                                                   FontSize="20" FontWeight="Bold"
                                                   Foreground="{StaticResource PrimaryBrush}"/>
                                        <TextBlock Text=" so'm"
                                                   FontSize="14" FontWeight="SemiBold"
                                                   Foreground="{StaticResource PrimaryBrush}"
                                                   VerticalAlignment="Bottom" Margin="0,0,0,2"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Buttons -->
                    <Border Grid.Row="2" Padding="28,14,28,20"
                            BorderBrush="{StaticResource BorderDefaultBrush}"
                            BorderThickness="0,1,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Yopish -->
                            <Button Grid.Column="0" Command="{Binding CloseReceiptDialogCommand}" Cursor="Hand">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border"
                                                Background="{StaticResource BackgroundInputBrush}"
                                                CornerRadius="10"
                                                Padding="0,13"
                                                BorderBrush="{StaticResource BorderDefaultBrush}"
                                                BorderThickness="1.5">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                                                      Fill="{StaticResource TextMutedBrush}" Width="13" Height="13" Stretch="Uniform" Margin="0,0,8,0"/>
                                                <TextBlock Text="Yopish" Foreground="{StaticResource TextSecondaryBrush}"
                                                           FontSize="14" FontWeight="SemiBold"/>
                                            </StackPanel>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="{StaticResource BorderLightBrush}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>

                            <!-- Chop etish -->
                            <Button Grid.Column="2" Command="{Binding PrintReceiptCommand}" Cursor="Hand">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" CornerRadius="10" Padding="0,13">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0.5">
                                                    <GradientStop Color="{StaticResource PrimaryColor}" Offset="0"/>
                                                    <GradientStop Color="{StaticResource PrimaryDarkColor}" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <Path Data="M18,3H6V7H18M19,12A1,1 0 0,1 18,11A1,1 0 0,1 19,10A1,1 0 0,1 20,11A1,1 0 0,1 19,12M16,19H8V14H16M19,8H5A3,3 0 0,0 2,11V17H6V21H18V17H22V11A3,3 0 0,0 19,8Z"
                                                      Fill="White" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                                                <TextBlock Text="Chop etish" Foreground="White"
                                                           FontSize="14" FontWeight="SemiBold"/>
                                            </StackPanel>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Opacity" Value="0.9"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Border>

    </Grid>
</UserControl>
